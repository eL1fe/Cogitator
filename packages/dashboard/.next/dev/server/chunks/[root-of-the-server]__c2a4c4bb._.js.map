{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/app/api/models/pull/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\n\nconst OLLAMA_URL = process.env.OLLAMA_URL || 'http://localhost:11434';\n\nexport const runtime = 'nodejs';\nexport const dynamic = 'force-dynamic';\n\nexport async function POST(request: NextRequest) {\n  const { name } = await request.json();\n  \n  if (!name) {\n    return new Response(JSON.stringify({ error: 'Model name required' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  try {\n    const response = await fetch(`${OLLAMA_URL}/api/pull`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name, stream: true }),\n    });\n\n    if (!response.ok || !response.body) {\n      return new Response(JSON.stringify({ error: 'Failed to pull model' }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Stream the response\n    const encoder = new TextEncoder();\n    const reader = response.body.getReader();\n    \n    const stream = new ReadableStream({\n      async start(controller) {\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) {\n            controller.enqueue(encoder.encode('data: {\"status\":\"done\"}\\n\\n'));\n            controller.close();\n            break;\n          }\n          \n          // Parse and forward progress\n          const text = new TextDecoder().decode(value);\n          const lines = text.split('\\n').filter(Boolean);\n          \n          for (const line of lines) {\n            try {\n              const progress = JSON.parse(line);\n              \n              // Calculate percentage if possible\n              if (progress.total && progress.completed) {\n                progress.percent = Math.round((progress.completed / progress.total) * 100);\n              }\n              \n              controller.enqueue(encoder.encode(`data: ${JSON.stringify(progress)}\\n\\n`));\n            } catch {\n              // Ignore parse errors\n            }\n          }\n        }\n      },\n    });\n\n    return new Response(stream, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n      },\n    });\n  } catch (error) {\n    console.error('Failed to pull model:', error);\n    return new Response(JSON.stringify({ error: 'Failed to connect to Ollama' }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,MAAM,UAAU;AAChB,MAAM,UAAU;AAEhB,eAAe,KAAK,OAAoB;IAC7C,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;IAEnC,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAsB,IAAI;YACpE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,WAAW,SAAS,CAAC,EAAE;YACrD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAM,QAAQ;YAAK;QAC5C;QAEA,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,IAAI,EAAE;YAClC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAuB,IAAI;gBACrE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,sBAAsB;QACtB,MAAM,UAAU,IAAI;QACpB,MAAM,SAAS,SAAS,IAAI,CAAC,SAAS;QAEtC,MAAM,SAAS,IAAI,eAAe;YAChC,MAAM,OAAM,UAAU;gBACpB,MAAO,KAAM;oBACX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,IAAI;oBACzC,IAAI,MAAM;wBACR,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;wBAClC,WAAW,KAAK;wBAChB;oBACF;oBAEA,6BAA6B;oBAC7B,MAAM,OAAO,IAAI,cAAc,MAAM,CAAC;oBACtC,MAAM,QAAQ,KAAK,KAAK,CAAC,MAAM,MAAM,CAAC;oBAEtC,KAAK,MAAM,QAAQ,MAAO;wBACxB,IAAI;4BACF,MAAM,WAAW,KAAK,KAAK,CAAC;4BAE5B,mCAAmC;4BACnC,IAAI,SAAS,KAAK,IAAI,SAAS,SAAS,EAAE;gCACxC,SAAS,OAAO,GAAG,KAAK,KAAK,CAAC,AAAC,SAAS,SAAS,GAAG,SAAS,KAAK,GAAI;4BACxE;4BAEA,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC,UAAU,IAAI,CAAC;wBAC3E,EAAE,OAAM;wBACN,sBAAsB;wBACxB;oBACF;gBACF;YACF;QACF;QAEA,OAAO,IAAI,SAAS,QAAQ;YAC1B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,cAAc;YAChB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAA8B,IAAI;YAC5E,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF"}}]
}