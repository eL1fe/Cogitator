{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/ollama.ts"],"sourcesContent":["const OLLAMA_URL = process.env.OLLAMA_URL || 'http://localhost:11434';\n\nexport interface OllamaModel {\n  name: string;\n  modified_at: string;\n  size: number;\n  digest: string;\n  details: {\n    format: string;\n    family: string;\n    parameter_size: string;\n    quantization_level: string;\n  };\n}\n\nexport interface OllamaModelInfo {\n  name: string;\n  displayName: string;\n  size: number;\n  sizeFormatted: string;\n  parameterSize: string;\n  family: string;\n  quantization: string;\n  modifiedAt: string;\n  isDownloaded: boolean;\n}\n\nexport interface PullProgress {\n  status: string;\n  digest?: string;\n  total?: number;\n  completed?: number;\n  percent?: number;\n}\n\nexport async function getOllamaModels(): Promise<OllamaModelInfo[]> {\n  try {\n    const response = await fetch(`${OLLAMA_URL}/api/tags`);\n    if (!response.ok) {\n      throw new Error(`Ollama error: ${response.status}`);\n    }\n    \n    const data = await response.json();\n    const models: OllamaModel[] = data.models || [];\n    \n    return models.map((m) => ({\n      name: m.name,\n      displayName: formatModelName(m.name),\n      size: m.size,\n      sizeFormatted: formatSize(m.size),\n      parameterSize: m.details?.parameter_size || 'Unknown',\n      family: m.details?.family || 'Unknown',\n      quantization: m.details?.quantization_level || 'Unknown',\n      modifiedAt: m.modified_at,\n      isDownloaded: true,\n    }));\n  } catch (error) {\n    console.error('Failed to fetch Ollama models:', error);\n    return [];\n  }\n}\n\nexport async function getModelInfo(name: string): Promise<OllamaModelInfo | null> {\n  try {\n    const response = await fetch(`${OLLAMA_URL}/api/show`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name }),\n    });\n    \n    if (!response.ok) return null;\n    \n    const data = await response.json();\n    return {\n      name,\n      displayName: formatModelName(name),\n      size: 0,\n      sizeFormatted: 'Unknown',\n      parameterSize: data.details?.parameter_size || 'Unknown',\n      family: data.details?.family || 'Unknown',\n      quantization: data.details?.quantization_level || 'Unknown',\n      modifiedAt: data.modified_at || '',\n      isDownloaded: true,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport async function pullModel(\n  name: string,\n  onProgress: (progress: PullProgress) => void\n): Promise<boolean> {\n  try {\n    const response = await fetch(`${OLLAMA_URL}/api/pull`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name, stream: true }),\n    });\n    \n    if (!response.ok || !response.body) {\n      throw new Error(`Failed to pull model: ${response.status}`);\n    }\n    \n    const reader = response.body.getReader();\n    const decoder = new TextDecoder();\n    \n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n      \n      const lines = decoder.decode(value).split('\\n').filter(Boolean);\n      for (const line of lines) {\n        try {\n          const progress = JSON.parse(line) as PullProgress;\n          if (progress.total && progress.completed) {\n            progress.percent = Math.round((progress.completed / progress.total) * 100);\n          }\n          onProgress(progress);\n        } catch {\n          // Ignore parse errors\n        }\n      }\n    }\n    \n    return true;\n  } catch (error) {\n    console.error('Failed to pull model:', error);\n    return false;\n  }\n}\n\nexport async function deleteModel(name: string): Promise<boolean> {\n  try {\n    const response = await fetch(`${OLLAMA_URL}/api/delete`, {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name }),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nexport async function checkOllamaHealth(): Promise<{ available: boolean; version?: string }> {\n  try {\n    const response = await fetch(`${OLLAMA_URL}/api/version`);\n    if (response.ok) {\n      const data = await response.json();\n      return { available: true, version: data.version };\n    }\n    return { available: false };\n  } catch {\n    return { available: false };\n  }\n}\n\n// Popular models that can be downloaded\nexport const POPULAR_MODELS = [\n  { name: 'llama3.2:3b', description: 'Llama 3.2 3B - Fast and efficient', size: '2.0 GB' },\n  { name: 'llama3.2:1b', description: 'Llama 3.2 1B - Ultra-lightweight', size: '1.3 GB' },\n  { name: 'llama3.1:8b', description: 'Llama 3.1 8B - Balanced performance', size: '4.7 GB' },\n  { name: 'llama3.1:70b', description: 'Llama 3.1 70B - High capability', size: '40 GB' },\n  { name: 'mistral:7b', description: 'Mistral 7B - Strong reasoning', size: '4.1 GB' },\n  { name: 'mixtral:8x7b', description: 'Mixtral 8x7B MoE - Expert mixture', size: '26 GB' },\n  { name: 'codellama:7b', description: 'Code Llama 7B - Code generation', size: '3.8 GB' },\n  { name: 'codellama:13b', description: 'Code Llama 13B - Better code', size: '7.4 GB' },\n  { name: 'gemma2:9b', description: 'Gemma 2 9B - Google model', size: '5.4 GB' },\n  { name: 'gemma2:2b', description: 'Gemma 2 2B - Compact Google', size: '1.6 GB' },\n  { name: 'qwen2.5:7b', description: 'Qwen 2.5 7B - Multilingual', size: '4.4 GB' },\n  { name: 'qwen2.5:14b', description: 'Qwen 2.5 14B - Larger Qwen', size: '8.9 GB' },\n  { name: 'phi3:mini', description: 'Phi-3 Mini - Microsoft compact', size: '2.2 GB' },\n  { name: 'deepseek-coder:6.7b', description: 'DeepSeek Coder - Code specialist', size: '3.8 GB' },\n  { name: 'nomic-embed-text', description: 'Nomic Embed - Text embeddings', size: '274 MB' },\n];\n\nfunction formatModelName(name: string): string {\n  const parts = name.split(':');\n  const base = parts[0].replace(/-/g, ' ').replace(/\\b\\w/g, (c) => c.toUpperCase());\n  const tag = parts[1] || 'latest';\n  return `${base} (${tag})`;\n}\n\nfunction formatSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 282, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/db/index.ts"],"sourcesContent":["import { Pool, PoolClient } from 'pg';\n\nlet pool: Pool | null = null;\n\nexport function getPool(): Pool {\n  if (!pool) {\n    pool = new Pool({\n      host: process.env.POSTGRES_HOST || 'localhost',\n      port: parseInt(process.env.POSTGRES_PORT || '5432'),\n      user: process.env.POSTGRES_USER || 'cogitator',\n      password: process.env.POSTGRES_PASSWORD || 'cogitator',\n      database: process.env.POSTGRES_DB || 'cogitator',\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 2000,\n    });\n  }\n  return pool;\n}\n\nexport async function query<T>(sql: string, params?: unknown[]): Promise<T[]> {\n  const pool = getPool();\n  const result = await pool.query(sql, params);\n  return result.rows as T[];\n}\n\nexport async function queryOne<T>(sql: string, params?: unknown[]): Promise<T | null> {\n  const rows = await query<T>(sql, params);\n  return rows[0] || null;\n}\n\nexport async function execute(sql: string, params?: unknown[]): Promise<number> {\n  const pool = getPool();\n  const result = await pool.query(sql, params);\n  return result.rowCount || 0;\n}\n\nexport async function withTransaction<T>(fn: (client: PoolClient) => Promise<T>): Promise<T> {\n  const pool = getPool();\n  const client = await pool.connect();\n  \n  try {\n    await client.query('BEGIN');\n    const result = await fn(client);\n    await client.query('COMMIT');\n    return result;\n  } catch (error) {\n    await client.query('ROLLBACK');\n    throw error;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function initializeSchema(): Promise<void> {\n  const pool = getPool();\n  \n  await pool.query(`\n    -- Agents table\n    CREATE TABLE IF NOT EXISTS dashboard_agents (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      model TEXT NOT NULL,\n      description TEXT,\n      instructions TEXT,\n      status TEXT DEFAULT 'offline' CHECK (status IN ('online', 'offline', 'busy')),\n      total_runs INTEGER DEFAULT 0,\n      total_tokens BIGINT DEFAULT 0,\n      total_cost DECIMAL(12, 6) DEFAULT 0,\n      last_run_at TIMESTAMPTZ,\n      created_at TIMESTAMPTZ DEFAULT NOW(),\n      updated_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Runs table\n    CREATE TABLE IF NOT EXISTS dashboard_runs (\n      id TEXT PRIMARY KEY,\n      agent_id TEXT NOT NULL REFERENCES dashboard_agents(id) ON DELETE CASCADE,\n      thread_id TEXT,\n      status TEXT DEFAULT 'running' CHECK (status IN ('running', 'completed', 'failed', 'cancelled')),\n      input TEXT NOT NULL,\n      output TEXT,\n      started_at TIMESTAMPTZ DEFAULT NOW(),\n      completed_at TIMESTAMPTZ,\n      duration INTEGER,\n      input_tokens INTEGER DEFAULT 0,\n      output_tokens INTEGER DEFAULT 0,\n      total_tokens INTEGER DEFAULT 0,\n      cost DECIMAL(12, 6) DEFAULT 0,\n      error TEXT\n    );\n\n    -- Tool calls table\n    CREATE TABLE IF NOT EXISTS dashboard_tool_calls (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      name TEXT NOT NULL,\n      arguments JSONB,\n      result JSONB,\n      status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'success', 'error')),\n      duration INTEGER,\n      started_at TIMESTAMPTZ DEFAULT NOW(),\n      completed_at TIMESTAMPTZ,\n      error TEXT\n    );\n\n    -- Spans table (for tracing)\n    CREATE TABLE IF NOT EXISTS dashboard_spans (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      trace_id TEXT NOT NULL,\n      parent_id TEXT,\n      name TEXT NOT NULL,\n      kind TEXT DEFAULT 'internal',\n      status TEXT DEFAULT 'unset' CHECK (status IN ('ok', 'error', 'unset')),\n      start_time BIGINT NOT NULL,\n      end_time BIGINT,\n      duration INTEGER,\n      attributes JSONB,\n      events JSONB\n    );\n\n    -- Logs table\n    CREATE TABLE IF NOT EXISTS dashboard_logs (\n      id TEXT PRIMARY KEY,\n      timestamp TIMESTAMPTZ DEFAULT NOW(),\n      level TEXT NOT NULL CHECK (level IN ('debug', 'info', 'warn', 'error')),\n      message TEXT NOT NULL,\n      source TEXT,\n      agent_id TEXT,\n      run_id TEXT,\n      metadata JSONB\n    );\n\n    -- Messages table (conversation history)\n    CREATE TABLE IF NOT EXISTS dashboard_messages (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system', 'tool')),\n      content TEXT NOT NULL,\n      tool_call_id TEXT,\n      created_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Config table (key-value store)\n    CREATE TABLE IF NOT EXISTS dashboard_config (\n      key TEXT PRIMARY KEY,\n      value JSONB NOT NULL,\n      updated_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Indexes\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_agent_id ON dashboard_runs(agent_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_status ON dashboard_runs(status);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_started_at ON dashboard_runs(started_at DESC);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_tool_calls_run_id ON dashboard_tool_calls(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_spans_run_id ON dashboard_spans(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_spans_trace_id ON dashboard_spans(trace_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_timestamp ON dashboard_logs(timestamp DESC);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_level ON dashboard_logs(level);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_run_id ON dashboard_logs(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_messages_run_id ON dashboard_messages(run_id);\n  `);\n}\n\nexport async function closePool(): Promise<void> {\n  if (pool) {\n    await pool.end();\n    pool = null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;;AAEA,IAAI,OAAoB;AAEjB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,qMAAI,CAAC;YACd,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI;YAC5C,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,UAAU,QAAQ,GAAG,CAAC,iBAAiB,IAAI;YAC3C,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;YACrC,KAAK;YACL,mBAAmB;YACnB,yBAAyB;QAC3B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAS,GAAW,EAAE,MAAkB;IAC5D,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO,OAAO,IAAI;AACpB;AAEO,eAAe,SAAY,GAAW,EAAE,MAAkB;IAC/D,MAAM,OAAO,MAAM,MAAS,KAAK;IACjC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,GAAW,EAAE,MAAkB;IAC3D,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO,OAAO,QAAQ,IAAI;AAC5B;AAEO,eAAe,gBAAmB,EAAsC;IAC7E,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,OAAO;IAEjC,IAAI;QACF,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM,SAAS,MAAM,GAAG;QACxB,MAAM,OAAO,KAAK,CAAC;QACnB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM;IACR,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,MAAM,OAAO;IAEb,MAAM,KAAK,KAAK,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAyGlB,CAAC;AACH;AAEO,eAAe;IACpB,IAAI,MAAM;QACR,MAAM,KAAK,GAAG;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 471, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/db/config.ts"],"sourcesContent":["import { query, queryOne, execute } from './index';\n\nexport async function getConfig<T>(key: string): Promise<T | null> {\n  const row = await queryOne<{ value: T }>(\n    'SELECT value FROM dashboard_config WHERE key = $1',\n    [key]\n  );\n  return row?.value || null;\n}\n\nexport async function setConfig<T>(key: string, value: T): Promise<void> {\n  await execute(\n    `INSERT INTO dashboard_config (key, value, updated_at)\n     VALUES ($1, $2, NOW())\n     ON CONFLICT (key) DO UPDATE SET value = $2, updated_at = NOW()`,\n    [key, JSON.stringify(value)]\n  );\n}\n\nexport async function deleteConfig(key: string): Promise<boolean> {\n  const count = await execute('DELETE FROM dashboard_config WHERE key = $1', [key]);\n  return count > 0;\n}\n\nexport async function getAllConfig(): Promise<Record<string, unknown>> {\n  const rows = await query<{ key: string; value: unknown }>(\n    'SELECT key, value FROM dashboard_config'\n  );\n  \n  const config: Record<string, unknown> = {};\n  for (const row of rows) {\n    config[row.key] = row.value;\n  }\n  return config;\n}\n\nexport interface CogitatorConfig {\n  llm: {\n    provider: string;\n    model: string;\n    temperature?: number;\n    maxTokens?: number;\n  };\n  memory?: {\n    adapter: string;\n    redis?: { url: string };\n    postgres?: { url: string };\n  };\n  sandbox?: {\n    enabled: boolean;\n    type: string;\n    timeout?: number;\n  };\n  limits?: {\n    maxTurns?: number;\n    maxTokens?: number;\n    maxCost?: number;\n  };\n}\n\nexport async function getCogitatorConfig(): Promise<CogitatorConfig | null> {\n  return getConfig<CogitatorConfig>('cogitator');\n}\n\nexport async function setCogitatorConfig(config: CogitatorConfig): Promise<void> {\n  await setConfig('cogitator', config);\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;;;AAEO,eAAe,UAAa,GAAW;IAC5C,MAAM,MAAM,MAAM,IAAA,gKAAQ,EACxB,qDACA;QAAC;KAAI;IAEP,OAAO,KAAK,SAAS;AACvB;AAEO,eAAe,UAAa,GAAW,EAAE,KAAQ;IACtD,MAAM,IAAA,+JAAO,EACX,CAAC;;mEAE8D,CAAC,EAChE;QAAC;QAAK,KAAK,SAAS,CAAC;KAAO;AAEhC;AAEO,eAAe,aAAa,GAAW;IAC5C,MAAM,QAAQ,MAAM,IAAA,+JAAO,EAAC,+CAA+C;QAAC;KAAI;IAChF,OAAO,QAAQ;AACjB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,IAAA,6JAAK,EACtB;IAGF,MAAM,SAAkC,CAAC;IACzC,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,CAAC,IAAI,GAAG,CAAC,GAAG,IAAI,KAAK;IAC7B;IACA,OAAO;AACT;AA0BO,eAAe;IACpB,OAAO,UAA2B;AACpC;AAEO,eAAe,mBAAmB,MAAuB;IAC9D,MAAM,UAAU,aAAa;AAC/B"}},
    {"offset": {"line": 532, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/app/api/models/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getOllamaModels, checkOllamaHealth, POPULAR_MODELS } from '@/lib/ollama';\nimport { getConfig, setConfig } from '@/lib/db/config';\n\ninterface ApiKeysConfig {\n  openai?: string;\n  anthropic?: string;\n  google?: string;\n}\n\nexport async function GET() {\n  try {\n    // Get Ollama models\n    const ollamaHealth = await checkOllamaHealth();\n    const ollamaModels = ollamaHealth.available ? await getOllamaModels() : [];\n    \n    // Get API keys status (not the actual keys)\n    const apiKeys = await getConfig<ApiKeysConfig>('api_keys');\n    \n    // Mark which popular models are downloaded\n    const downloadedNames = new Set(ollamaModels.map((m) => m.name));\n    const availableModels = POPULAR_MODELS.map((m) => ({\n      ...m,\n      isDownloaded: downloadedNames.has(m.name),\n    }));\n\n    // Cloud providers\n    const cloudProviders = [\n      {\n        id: 'openai',\n        name: 'OpenAI',\n        models: ['gpt-4o', 'gpt-4o-mini', 'gpt-4-turbo', 'gpt-3.5-turbo', 'o1-preview', 'o1-mini'],\n        configured: !!apiKeys?.openai || !!process.env.OPENAI_API_KEY,\n      },\n      {\n        id: 'anthropic',\n        name: 'Anthropic',\n        models: ['claude-3-5-sonnet-20241022', 'claude-3-5-haiku-20241022', 'claude-3-opus-20240229'],\n        configured: !!apiKeys?.anthropic || !!process.env.ANTHROPIC_API_KEY,\n      },\n      {\n        id: 'google',\n        name: 'Google',\n        models: ['gemini-1.5-pro', 'gemini-1.5-flash', 'gemini-2.0-flash-exp'],\n        configured: !!apiKeys?.google || !!process.env.GOOGLE_API_KEY,\n      },\n    ];\n\n    return NextResponse.json({\n      ollama: {\n        available: ollamaHealth.available,\n        version: ollamaHealth.version,\n        models: ollamaModels,\n      },\n      available: availableModels,\n      cloud: cloudProviders,\n    });\n  } catch (error) {\n    console.error('Failed to fetch models:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch models' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { action } = body;\n\n    if (action === 'save_api_keys') {\n      const { openai, anthropic, google } = body;\n      \n      // Only save non-empty keys\n      const keys: ApiKeysConfig = {};\n      if (openai) keys.openai = openai;\n      if (anthropic) keys.anthropic = anthropic;\n      if (google) keys.google = google;\n      \n      await setConfig('api_keys', keys);\n      \n      return NextResponse.json({ success: true });\n    }\n\n    return NextResponse.json(\n      { error: 'Unknown action' },\n      { status: 400 }\n    );\n  } catch (error) {\n    console.error('Failed to process request:', error);\n    return NextResponse.json(\n      { error: 'Failed to process request' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;;;;AAQO,eAAe;IACpB,IAAI;QACF,oBAAoB;QACpB,MAAM,eAAe,MAAM,IAAA,oKAAiB;QAC5C,MAAM,eAAe,aAAa,SAAS,GAAG,MAAM,IAAA,kKAAe,MAAK,EAAE;QAE1E,4CAA4C;QAC5C,MAAM,UAAU,MAAM,IAAA,kKAAS,EAAgB;QAE/C,2CAA2C;QAC3C,MAAM,kBAAkB,IAAI,IAAI,aAAa,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;QAC9D,MAAM,kBAAkB,iKAAc,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;gBACjD,GAAG,CAAC;gBACJ,cAAc,gBAAgB,GAAG,CAAC,EAAE,IAAI;YAC1C,CAAC;QAED,kBAAkB;QAClB,MAAM,iBAAiB;YACrB;gBACE,IAAI;gBACJ,MAAM;gBACN,QAAQ;oBAAC;oBAAU;oBAAe;oBAAe;oBAAiB;oBAAc;iBAAU;gBAC1F,YAAY,CAAC,CAAC,SAAS,UAAU,CAAC,CAAC,QAAQ,GAAG,CAAC,cAAc;YAC/D;YACA;gBACE,IAAI;gBACJ,MAAM;gBACN,QAAQ;oBAAC;oBAA8B;oBAA6B;iBAAyB;gBAC7F,YAAY,CAAC,CAAC,SAAS,aAAa,CAAC,CAAC,QAAQ,GAAG,CAAC,iBAAiB;YACrE;YACA;gBACE,IAAI;gBACJ,MAAM;gBACN,QAAQ;oBAAC;oBAAkB;oBAAoB;iBAAuB;gBACtE,YAAY,CAAC,CAAC,SAAS,UAAU,CAAC,CAAC,QAAQ,GAAG,CAAC,cAAc;YAC/D;SACD;QAED,OAAO,qPAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;gBACN,WAAW,aAAa,SAAS;gBACjC,SAAS,aAAa,OAAO;gBAC7B,QAAQ;YACV;YACA,WAAW;YACX,OAAO;QACT;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,MAAM,EAAE,GAAG;QAEnB,IAAI,WAAW,iBAAiB;YAC9B,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG;YAEtC,2BAA2B;YAC3B,MAAM,OAAsB,CAAC;YAC7B,IAAI,QAAQ,KAAK,MAAM,GAAG;YAC1B,IAAI,WAAW,KAAK,SAAS,GAAG;YAChC,IAAI,QAAQ,KAAK,MAAM,GAAG;YAE1B,MAAM,IAAA,kKAAS,EAAC,YAAY;YAE5B,OAAO,qPAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C;QAEA,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}