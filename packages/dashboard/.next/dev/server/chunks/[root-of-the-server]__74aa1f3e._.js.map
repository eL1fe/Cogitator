{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/db/index.ts"],"sourcesContent":["import { Pool, PoolClient } from 'pg';\n\nlet pool: Pool | null = null;\n\nexport function getPool(): Pool {\n  if (!pool) {\n    pool = new Pool({\n      host: process.env.POSTGRES_HOST || 'localhost',\n      port: parseInt(process.env.POSTGRES_PORT || '5432'),\n      user: process.env.POSTGRES_USER || 'cogitator',\n      password: process.env.POSTGRES_PASSWORD || 'cogitator',\n      database: process.env.POSTGRES_DB || 'cogitator',\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 2000,\n    });\n  }\n  return pool;\n}\n\nexport async function query<T>(sql: string, params?: unknown[]): Promise<T[]> {\n  const pool = getPool();\n  const result = await pool.query(sql, params);\n  return result.rows as T[];\n}\n\nexport async function queryOne<T>(sql: string, params?: unknown[]): Promise<T | null> {\n  const rows = await query<T>(sql, params);\n  return rows[0] || null;\n}\n\nexport async function execute(sql: string, params?: unknown[]): Promise<number> {\n  const pool = getPool();\n  const result = await pool.query(sql, params);\n  return result.rowCount || 0;\n}\n\nexport async function withTransaction<T>(fn: (client: PoolClient) => Promise<T>): Promise<T> {\n  const pool = getPool();\n  const client = await pool.connect();\n  \n  try {\n    await client.query('BEGIN');\n    const result = await fn(client);\n    await client.query('COMMIT');\n    return result;\n  } catch (error) {\n    await client.query('ROLLBACK');\n    throw error;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function initializeSchema(): Promise<void> {\n  const pool = getPool();\n  \n  await pool.query(`\n    -- Agents table\n    CREATE TABLE IF NOT EXISTS dashboard_agents (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      model TEXT NOT NULL,\n      description TEXT,\n      instructions TEXT,\n      status TEXT DEFAULT 'offline' CHECK (status IN ('online', 'offline', 'busy')),\n      total_runs INTEGER DEFAULT 0,\n      total_tokens BIGINT DEFAULT 0,\n      total_cost DECIMAL(12, 6) DEFAULT 0,\n      last_run_at TIMESTAMPTZ,\n      created_at TIMESTAMPTZ DEFAULT NOW(),\n      updated_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Runs table\n    CREATE TABLE IF NOT EXISTS dashboard_runs (\n      id TEXT PRIMARY KEY,\n      agent_id TEXT NOT NULL REFERENCES dashboard_agents(id) ON DELETE CASCADE,\n      thread_id TEXT,\n      status TEXT DEFAULT 'running' CHECK (status IN ('running', 'completed', 'failed', 'cancelled')),\n      input TEXT NOT NULL,\n      output TEXT,\n      started_at TIMESTAMPTZ DEFAULT NOW(),\n      completed_at TIMESTAMPTZ,\n      duration INTEGER,\n      input_tokens INTEGER DEFAULT 0,\n      output_tokens INTEGER DEFAULT 0,\n      total_tokens INTEGER DEFAULT 0,\n      cost DECIMAL(12, 6) DEFAULT 0,\n      error TEXT\n    );\n\n    -- Tool calls table\n    CREATE TABLE IF NOT EXISTS dashboard_tool_calls (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      name TEXT NOT NULL,\n      arguments JSONB,\n      result JSONB,\n      status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'success', 'error')),\n      duration INTEGER,\n      started_at TIMESTAMPTZ DEFAULT NOW(),\n      completed_at TIMESTAMPTZ,\n      error TEXT\n    );\n\n    -- Spans table (for tracing)\n    CREATE TABLE IF NOT EXISTS dashboard_spans (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      trace_id TEXT NOT NULL,\n      parent_id TEXT,\n      name TEXT NOT NULL,\n      kind TEXT DEFAULT 'internal',\n      status TEXT DEFAULT 'unset' CHECK (status IN ('ok', 'error', 'unset')),\n      start_time BIGINT NOT NULL,\n      end_time BIGINT,\n      duration INTEGER,\n      attributes JSONB,\n      events JSONB\n    );\n\n    -- Logs table\n    CREATE TABLE IF NOT EXISTS dashboard_logs (\n      id TEXT PRIMARY KEY,\n      timestamp TIMESTAMPTZ DEFAULT NOW(),\n      level TEXT NOT NULL CHECK (level IN ('debug', 'info', 'warn', 'error')),\n      message TEXT NOT NULL,\n      source TEXT,\n      agent_id TEXT,\n      run_id TEXT,\n      metadata JSONB\n    );\n\n    -- Messages table (conversation history)\n    CREATE TABLE IF NOT EXISTS dashboard_messages (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system', 'tool')),\n      content TEXT NOT NULL,\n      tool_call_id TEXT,\n      created_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Config table (key-value store)\n    CREATE TABLE IF NOT EXISTS dashboard_config (\n      key TEXT PRIMARY KEY,\n      value JSONB NOT NULL,\n      updated_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Indexes\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_agent_id ON dashboard_runs(agent_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_status ON dashboard_runs(status);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_started_at ON dashboard_runs(started_at DESC);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_tool_calls_run_id ON dashboard_tool_calls(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_spans_run_id ON dashboard_spans(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_spans_trace_id ON dashboard_spans(trace_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_timestamp ON dashboard_logs(timestamp DESC);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_level ON dashboard_logs(level);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_run_id ON dashboard_logs(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_messages_run_id ON dashboard_messages(run_id);\n  `);\n}\n\nexport async function closePool(): Promise<void> {\n  if (pool) {\n    await pool.end();\n    pool = null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;;AAEA,IAAI,OAAoB;AAEjB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,qMAAI,CAAC;YACd,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI;YAC5C,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,UAAU,QAAQ,GAAG,CAAC,iBAAiB,IAAI;YAC3C,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;YACrC,KAAK;YACL,mBAAmB;YACnB,yBAAyB;QAC3B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAS,GAAW,EAAE,MAAkB;IAC5D,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO,OAAO,IAAI;AACpB;AAEO,eAAe,SAAY,GAAW,EAAE,MAAkB;IAC/D,MAAM,OAAO,MAAM,MAAS,KAAK;IACjC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,GAAW,EAAE,MAAkB;IAC3D,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO,OAAO,QAAQ,IAAI;AAC5B;AAEO,eAAe,gBAAmB,EAAsC;IAC7E,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,OAAO;IAEjC,IAAI;QACF,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM,SAAS,MAAM,GAAG;QACxB,MAAM,OAAO,KAAK,CAAC;QACnB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM;IACR,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,MAAM,OAAO;IAEb,MAAM,KAAK,KAAK,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAyGlB,CAAC;AACH;AAEO,eAAe;IACpB,IAAI,MAAM;QACR,MAAM,KAAK,GAAG;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/db/agents.ts"],"sourcesContent":["import { query, queryOne, execute } from './index';\nimport { nanoid } from 'nanoid';\nimport type { Agent } from '@/types';\n\ninterface AgentRow {\n  id: string;\n  name: string;\n  model: string;\n  description: string | null;\n  instructions: string | null;\n  status: 'online' | 'offline' | 'busy';\n  total_runs: number;\n  total_tokens: string;\n  total_cost: string;\n  last_run_at: Date | null;\n  created_at: Date;\n  updated_at: Date;\n}\n\nfunction rowToAgent(row: AgentRow): Agent {\n  return {\n    id: row.id,\n    name: row.name,\n    model: row.model,\n    status: row.status,\n    totalRuns: row.total_runs,\n    totalTokens: parseInt(row.total_tokens) || 0,\n    totalCost: parseFloat(row.total_cost) || 0,\n    lastRunAt: row.last_run_at?.toISOString() || null,\n    createdAt: row.created_at.toISOString(),\n  };\n}\n\nexport async function getAllAgents(): Promise<Agent[]> {\n  const rows = await query<AgentRow>(\n    'SELECT * FROM dashboard_agents ORDER BY created_at DESC'\n  );\n  return rows.map(rowToAgent);\n}\n\nexport async function getAgentById(id: string): Promise<Agent | null> {\n  const row = await queryOne<AgentRow>(\n    'SELECT * FROM dashboard_agents WHERE id = $1',\n    [id]\n  );\n  return row ? rowToAgent(row) : null;\n}\n\nexport async function createAgent(data: {\n  name: string;\n  model: string;\n  description?: string;\n  instructions?: string;\n}): Promise<Agent> {\n  const id = `agent_${nanoid(12)}`;\n  \n  await execute(\n    `INSERT INTO dashboard_agents (id, name, model, description, instructions)\n     VALUES ($1, $2, $3, $4, $5)`,\n    [id, data.name, data.model, data.description || null, data.instructions || null]\n  );\n\n  const agent = await getAgentById(id);\n  return agent!;\n}\n\nexport async function updateAgent(id: string, data: Partial<{\n  name: string;\n  model: string;\n  description: string;\n  instructions: string;\n  status: 'online' | 'offline' | 'busy';\n}>): Promise<Agent | null> {\n  const updates: string[] = [];\n  const values: unknown[] = [];\n  let paramIndex = 1;\n\n  if (data.name !== undefined) {\n    updates.push(`name = $${paramIndex++}`);\n    values.push(data.name);\n  }\n  if (data.model !== undefined) {\n    updates.push(`model = $${paramIndex++}`);\n    values.push(data.model);\n  }\n  if (data.description !== undefined) {\n    updates.push(`description = $${paramIndex++}`);\n    values.push(data.description);\n  }\n  if (data.instructions !== undefined) {\n    updates.push(`instructions = $${paramIndex++}`);\n    values.push(data.instructions);\n  }\n  if (data.status !== undefined) {\n    updates.push(`status = $${paramIndex++}`);\n    values.push(data.status);\n  }\n\n  if (updates.length === 0) return getAgentById(id);\n\n  updates.push(`updated_at = NOW()`);\n  values.push(id);\n\n  await execute(\n    `UPDATE dashboard_agents SET ${updates.join(', ')} WHERE id = $${paramIndex}`,\n    values\n  );\n\n  return getAgentById(id);\n}\n\nexport async function deleteAgent(id: string): Promise<boolean> {\n  const count = await execute('DELETE FROM dashboard_agents WHERE id = $1', [id]);\n  return count > 0;\n}\n\nexport async function incrementAgentStats(id: string, tokens: number, cost: number): Promise<void> {\n  await execute(\n    `UPDATE dashboard_agents \n     SET total_runs = total_runs + 1, \n         total_tokens = total_tokens + $1,\n         total_cost = total_cost + $2,\n         last_run_at = NOW(),\n         updated_at = NOW()\n     WHERE id = $3`,\n    [tokens, cost, id]\n  );\n}\n\nexport async function setAgentStatus(id: string, status: 'online' | 'offline' | 'busy'): Promise<void> {\n  await execute(\n    'UPDATE dashboard_agents SET status = $1, updated_at = NOW() WHERE id = $2',\n    [status, id]\n  );\n}\n\nexport async function getAgentCount(): Promise<number> {\n  const result = await queryOne<{ count: string }>('SELECT COUNT(*) as count FROM dashboard_agents');\n  return parseInt(result?.count || '0');\n}\n\nexport async function seedDefaultAgents(): Promise<void> {\n  const count = await getAgentCount();\n  \n  if (count === 0) {\n    const defaultAgents = [\n      { name: 'Research Agent', model: 'gpt-4o', description: 'Analyzes data and provides comprehensive research reports' },\n      { name: 'Code Assistant', model: 'claude-3-5-sonnet', description: 'Helps with code reviews, refactoring, and documentation' },\n      { name: 'Data Analyst', model: 'gpt-4o-mini', description: 'Processes data and generates analytical insights' },\n    ];\n\n    for (const agent of defaultAgents) {\n      await createAgent(agent);\n    }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 398, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/app/api/agents/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getAllAgents, createAgent, seedDefaultAgents } from '@/lib/db/agents';\nimport { initializeSchema } from '@/lib/db';\n\nlet initialized = false;\n\nasync function ensureInitialized() {\n  if (!initialized) {\n    try {\n      await initializeSchema();\n      await seedDefaultAgents();\n      initialized = true;\n    } catch (error) {\n      console.error('Failed to initialize database:', error);\n    }\n  }\n}\n\nexport async function GET() {\n  try {\n    await ensureInitialized();\n    const agents = await getAllAgents();\n    return NextResponse.json(agents);\n  } catch (error) {\n    console.error('Failed to fetch agents:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch agents' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    await ensureInitialized();\n    const body = await request.json();\n    \n    if (!body.name || !body.model) {\n      return NextResponse.json(\n        { error: 'Name and model are required' },\n        { status: 400 }\n      );\n    }\n\n    const agent = await createAgent({\n      name: body.name,\n      model: body.model,\n      description: body.description,\n      instructions: body.instructions,\n    });\n\n    return NextResponse.json(agent, { status: 201 });\n  } catch (error) {\n    console.error('Failed to create agent:', error);\n    return NextResponse.json(\n      { error: 'Failed to create agent' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;;;;;AAEA,IAAI,cAAc;AAElB,eAAe;IACb,IAAI,CAAC,aAAa;QAChB,IAAI;YACF,MAAM,IAAA,wKAAgB;YACtB,MAAM,IAAA,0KAAiB;YACvB,cAAc;QAChB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACF;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM;QACN,MAAM,SAAS,MAAM,IAAA,qKAAY;QACjC,OAAO,qPAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM;QACN,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,KAAK,EAAE;YAC7B,OAAO,qPAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,MAAM,IAAA,oKAAW,EAAC;YAC9B,MAAM,KAAK,IAAI;YACf,OAAO,KAAK,KAAK;YACjB,aAAa,KAAK,WAAW;YAC7B,cAAc,KAAK,YAAY;QACjC;QAEA,OAAO,qPAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAChD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}