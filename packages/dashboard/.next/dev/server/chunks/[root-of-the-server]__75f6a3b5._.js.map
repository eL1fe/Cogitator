{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/db/index.ts"],"sourcesContent":["import { Pool, PoolClient } from 'pg';\n\nlet pool: Pool | null = null;\n\nexport function getPool(): Pool {\n  if (!pool) {\n    pool = new Pool({\n      host: process.env.POSTGRES_HOST || 'localhost',\n      port: parseInt(process.env.POSTGRES_PORT || '5432'),\n      user: process.env.POSTGRES_USER || 'cogitator',\n      password: process.env.POSTGRES_PASSWORD || 'cogitator',\n      database: process.env.POSTGRES_DB || 'cogitator',\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 2000,\n    });\n  }\n  return pool;\n}\n\nexport async function query<T>(sql: string, params?: unknown[]): Promise<T[]> {\n  const pool = getPool();\n  const result = await pool.query(sql, params);\n  return result.rows as T[];\n}\n\nexport async function queryOne<T>(sql: string, params?: unknown[]): Promise<T | null> {\n  const rows = await query<T>(sql, params);\n  return rows[0] || null;\n}\n\nexport async function execute(sql: string, params?: unknown[]): Promise<number> {\n  const pool = getPool();\n  const result = await pool.query(sql, params);\n  return result.rowCount || 0;\n}\n\nexport async function withTransaction<T>(fn: (client: PoolClient) => Promise<T>): Promise<T> {\n  const pool = getPool();\n  const client = await pool.connect();\n  \n  try {\n    await client.query('BEGIN');\n    const result = await fn(client);\n    await client.query('COMMIT');\n    return result;\n  } catch (error) {\n    await client.query('ROLLBACK');\n    throw error;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function initializeSchema(): Promise<void> {\n  const pool = getPool();\n  \n  await pool.query(`\n    -- Agents table\n    CREATE TABLE IF NOT EXISTS dashboard_agents (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      model TEXT NOT NULL,\n      description TEXT,\n      instructions TEXT,\n      status TEXT DEFAULT 'offline' CHECK (status IN ('online', 'offline', 'busy')),\n      total_runs INTEGER DEFAULT 0,\n      total_tokens BIGINT DEFAULT 0,\n      total_cost DECIMAL(12, 6) DEFAULT 0,\n      last_run_at TIMESTAMPTZ,\n      created_at TIMESTAMPTZ DEFAULT NOW(),\n      updated_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Runs table\n    CREATE TABLE IF NOT EXISTS dashboard_runs (\n      id TEXT PRIMARY KEY,\n      agent_id TEXT NOT NULL REFERENCES dashboard_agents(id) ON DELETE CASCADE,\n      thread_id TEXT,\n      status TEXT DEFAULT 'running' CHECK (status IN ('running', 'completed', 'failed', 'cancelled')),\n      input TEXT NOT NULL,\n      output TEXT,\n      started_at TIMESTAMPTZ DEFAULT NOW(),\n      completed_at TIMESTAMPTZ,\n      duration INTEGER,\n      input_tokens INTEGER DEFAULT 0,\n      output_tokens INTEGER DEFAULT 0,\n      total_tokens INTEGER DEFAULT 0,\n      cost DECIMAL(12, 6) DEFAULT 0,\n      error TEXT\n    );\n\n    -- Tool calls table\n    CREATE TABLE IF NOT EXISTS dashboard_tool_calls (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      name TEXT NOT NULL,\n      arguments JSONB,\n      result JSONB,\n      status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'success', 'error')),\n      duration INTEGER,\n      started_at TIMESTAMPTZ DEFAULT NOW(),\n      completed_at TIMESTAMPTZ,\n      error TEXT\n    );\n\n    -- Spans table (for tracing)\n    CREATE TABLE IF NOT EXISTS dashboard_spans (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      trace_id TEXT NOT NULL,\n      parent_id TEXT,\n      name TEXT NOT NULL,\n      kind TEXT DEFAULT 'internal',\n      status TEXT DEFAULT 'unset' CHECK (status IN ('ok', 'error', 'unset')),\n      start_time BIGINT NOT NULL,\n      end_time BIGINT,\n      duration INTEGER,\n      attributes JSONB,\n      events JSONB\n    );\n\n    -- Logs table\n    CREATE TABLE IF NOT EXISTS dashboard_logs (\n      id TEXT PRIMARY KEY,\n      timestamp TIMESTAMPTZ DEFAULT NOW(),\n      level TEXT NOT NULL CHECK (level IN ('debug', 'info', 'warn', 'error')),\n      message TEXT NOT NULL,\n      source TEXT,\n      agent_id TEXT,\n      run_id TEXT,\n      metadata JSONB\n    );\n\n    -- Messages table (conversation history)\n    CREATE TABLE IF NOT EXISTS dashboard_messages (\n      id TEXT PRIMARY KEY,\n      run_id TEXT NOT NULL REFERENCES dashboard_runs(id) ON DELETE CASCADE,\n      role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system', 'tool')),\n      content TEXT NOT NULL,\n      tool_call_id TEXT,\n      created_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Config table (key-value store)\n    CREATE TABLE IF NOT EXISTS dashboard_config (\n      key TEXT PRIMARY KEY,\n      value JSONB NOT NULL,\n      updated_at TIMESTAMPTZ DEFAULT NOW()\n    );\n\n    -- Indexes\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_agent_id ON dashboard_runs(agent_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_status ON dashboard_runs(status);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_runs_started_at ON dashboard_runs(started_at DESC);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_tool_calls_run_id ON dashboard_tool_calls(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_spans_run_id ON dashboard_spans(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_spans_trace_id ON dashboard_spans(trace_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_timestamp ON dashboard_logs(timestamp DESC);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_level ON dashboard_logs(level);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_logs_run_id ON dashboard_logs(run_id);\n    CREATE INDEX IF NOT EXISTS idx_dashboard_messages_run_id ON dashboard_messages(run_id);\n  `);\n}\n\nexport async function closePool(): Promise<void> {\n  if (pool) {\n    await pool.end();\n    pool = null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;;AAEA,IAAI,OAAoB;AAEjB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,qMAAI,CAAC;YACd,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI;YAC5C,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,UAAU,QAAQ,GAAG,CAAC,iBAAiB,IAAI;YAC3C,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;YACrC,KAAK;YACL,mBAAmB;YACnB,yBAAyB;QAC3B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAS,GAAW,EAAE,MAAkB;IAC5D,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO,OAAO,IAAI;AACpB;AAEO,eAAe,SAAY,GAAW,EAAE,MAAkB;IAC/D,MAAM,OAAO,MAAM,MAAS,KAAK;IACjC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,GAAW,EAAE,MAAkB;IAC3D,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO,OAAO,QAAQ,IAAI;AAC5B;AAEO,eAAe,gBAAmB,EAAsC;IAC7E,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,OAAO;IAEjC,IAAI;QACF,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM,SAAS,MAAM,GAAG;QACxB,MAAM,OAAO,KAAK,CAAC;QACnB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM;IACR,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,MAAM,OAAO;IAEb,MAAM,KAAK,KAAK,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAyGlB,CAAC;AACH;AAEO,eAAe;IACpB,IAAI,MAAM;QACR,MAAM,KAAK,GAAG;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/lib/db/config.ts"],"sourcesContent":["import { query, queryOne, execute } from './index';\n\nexport async function getConfig<T>(key: string): Promise<T | null> {\n  const row = await queryOne<{ value: T }>(\n    'SELECT value FROM dashboard_config WHERE key = $1',\n    [key]\n  );\n  return row?.value || null;\n}\n\nexport async function setConfig<T>(key: string, value: T): Promise<void> {\n  await execute(\n    `INSERT INTO dashboard_config (key, value, updated_at)\n     VALUES ($1, $2, NOW())\n     ON CONFLICT (key) DO UPDATE SET value = $2, updated_at = NOW()`,\n    [key, JSON.stringify(value)]\n  );\n}\n\nexport async function deleteConfig(key: string): Promise<boolean> {\n  const count = await execute('DELETE FROM dashboard_config WHERE key = $1', [key]);\n  return count > 0;\n}\n\nexport async function getAllConfig(): Promise<Record<string, unknown>> {\n  const rows = await query<{ key: string; value: unknown }>(\n    'SELECT key, value FROM dashboard_config'\n  );\n  \n  const config: Record<string, unknown> = {};\n  for (const row of rows) {\n    config[row.key] = row.value;\n  }\n  return config;\n}\n\nexport interface CogitatorConfig {\n  llm: {\n    provider: string;\n    model: string;\n    temperature?: number;\n    maxTokens?: number;\n  };\n  memory?: {\n    adapter: string;\n    redis?: { url: string };\n    postgres?: { url: string };\n  };\n  sandbox?: {\n    enabled: boolean;\n    type: string;\n    timeout?: number;\n  };\n  limits?: {\n    maxTurns?: number;\n    maxTokens?: number;\n    maxCost?: number;\n  };\n}\n\nexport async function getCogitatorConfig(): Promise<CogitatorConfig | null> {\n  return getConfig<CogitatorConfig>('cogitator');\n}\n\nexport async function setCogitatorConfig(config: CogitatorConfig): Promise<void> {\n  await setConfig('cogitator', config);\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;;;AAEO,eAAe,UAAa,GAAW;IAC5C,MAAM,MAAM,MAAM,IAAA,gKAAQ,EACxB,qDACA;QAAC;KAAI;IAEP,OAAO,KAAK,SAAS;AACvB;AAEO,eAAe,UAAa,GAAW,EAAE,KAAQ;IACtD,MAAM,IAAA,+JAAO,EACX,CAAC;;mEAE8D,CAAC,EAChE;QAAC;QAAK,KAAK,SAAS,CAAC;KAAO;AAEhC;AAEO,eAAe,aAAa,GAAW;IAC5C,MAAM,QAAQ,MAAM,IAAA,+JAAO,EAAC,+CAA+C;QAAC;KAAI;IAChF,OAAO,QAAQ;AACjB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,IAAA,6JAAK,EACtB;IAGF,MAAM,SAAkC,CAAC;IACzC,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,CAAC,IAAI,GAAG,CAAC,GAAG,IAAI,KAAK;IAC7B;IACA,OAAO;AACT;AA0BO,eAAe;IACpB,OAAO,UAA2B;AACpC;AAEO,eAAe,mBAAmB,MAAuB;IAC9D,MAAM,UAAU,aAAa;AAC/B"}},
    {"offset": {"line": 298, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Projects/Cogitator/packages/dashboard/src/app/api/config/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getCogitatorConfig, setCogitatorConfig, getAllConfig } from '@/lib/db/config';\nimport { initializeSchema } from '@/lib/db';\n\nlet initialized = false;\n\nasync function ensureInitialized() {\n  if (!initialized) {\n    try {\n      await initializeSchema();\n      initialized = true;\n    } catch (error) {\n      console.error('Failed to initialize database:', error);\n    }\n  }\n}\n\nexport async function GET() {\n  try {\n    await ensureInitialized();\n    \n    const config = await getCogitatorConfig();\n    const allConfig = await getAllConfig();\n    \n    // Check environment variables\n    const envVars = {\n      POSTGRES_HOST: process.env.POSTGRES_HOST || 'localhost',\n      POSTGRES_PORT: process.env.POSTGRES_PORT || '5432',\n      REDIS_HOST: process.env.REDIS_HOST || 'localhost',\n      REDIS_PORT: process.env.REDIS_PORT || '6379',\n      OPENAI_API_KEY: process.env.OPENAI_API_KEY ? '***' : undefined,\n      ANTHROPIC_API_KEY: process.env.ANTHROPIC_API_KEY ? '***' : undefined,\n      GOOGLE_API_KEY: process.env.GOOGLE_API_KEY ? '***' : undefined,\n    };\n\n    return NextResponse.json({\n      cogitator: config || getDefaultConfig(),\n      all: allConfig,\n      environment: envVars,\n    });\n  } catch (error) {\n    console.error('Failed to fetch config:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch config' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    await ensureInitialized();\n    const body = await request.json();\n    \n    if (!body.llm?.provider || !body.llm?.model) {\n      return NextResponse.json(\n        { error: 'llm.provider and llm.model are required' },\n        { status: 400 }\n      );\n    }\n\n    await setCogitatorConfig(body);\n    const config = await getCogitatorConfig();\n\n    return NextResponse.json(config);\n  } catch (error) {\n    console.error('Failed to update config:', error);\n    return NextResponse.json(\n      { error: 'Failed to update config' },\n      { status: 500 }\n    );\n  }\n}\n\nfunction getDefaultConfig() {\n  return {\n    llm: {\n      provider: 'openai',\n      model: 'gpt-4o-mini',\n      temperature: 0.7,\n      maxTokens: 4096,\n    },\n    memory: {\n      adapter: 'postgres',\n      postgres: {\n        url: `postgresql://${process.env.POSTGRES_USER || 'cogitator'}:${process.env.POSTGRES_PASSWORD || 'cogitator'}@${process.env.POSTGRES_HOST || 'localhost'}:${process.env.POSTGRES_PORT || '5432'}/${process.env.POSTGRES_DB || 'cogitator'}`,\n      },\n    },\n    sandbox: {\n      enabled: false,\n      type: 'docker',\n      timeout: 30000,\n    },\n    limits: {\n      maxTurns: 10,\n      maxTokens: 100000,\n      maxCost: 1.0,\n    },\n  };\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;;;;;AAEA,IAAI,cAAc;AAElB,eAAe;IACb,IAAI,CAAC,aAAa;QAChB,IAAI;YACF,MAAM,IAAA,wKAAgB;YACtB,cAAc;QAChB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACF;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM;QAEN,MAAM,SAAS,MAAM,IAAA,2KAAkB;QACvC,MAAM,YAAY,MAAM,IAAA,qKAAY;QAEpC,8BAA8B;QAC9B,MAAM,UAAU;YACd,eAAe,QAAQ,GAAG,CAAC,aAAa,IAAI;YAC5C,eAAe,QAAQ,GAAG,CAAC,aAAa,IAAI;YAC5C,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;YACtC,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;YACtC,gBAAgB,QAAQ,GAAG,CAAC,cAAc,GAAG,QAAQ;YACrD,mBAAmB,QAAQ,GAAG,CAAC,iBAAiB,GAAG,QAAQ;YAC3D,gBAAgB,QAAQ,GAAG,CAAC,cAAc,GAAG,QAAQ;QACvD;QAEA,OAAO,qPAAY,CAAC,IAAI,CAAC;YACvB,WAAW,UAAU;YACrB,KAAK;YACL,aAAa;QACf;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM;QACN,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,IAAI,CAAC,KAAK,GAAG,EAAE,YAAY,CAAC,KAAK,GAAG,EAAE,OAAO;YAC3C,OAAO,qPAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0C,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,IAAA,2KAAkB,EAAC;QACzB,MAAM,SAAS,MAAM,IAAA,2KAAkB;QAEvC,OAAO,qPAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,qPAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,SAAS;IACP,OAAO;QACL,KAAK;YACH,UAAU;YACV,OAAO;YACP,aAAa;YACb,WAAW;QACb;QACA,QAAQ;YACN,SAAS;YACT,UAAU;gBACR,KAAK,CAAC,aAAa,EAAE,QAAQ,GAAG,CAAC,aAAa,IAAI,YAAY,CAAC,EAAE,QAAQ,GAAG,CAAC,iBAAiB,IAAI,YAAY,CAAC,EAAE,QAAQ,GAAG,CAAC,aAAa,IAAI,YAAY,CAAC,EAAE,QAAQ,GAAG,CAAC,aAAa,IAAI,OAAO,CAAC,EAAE,QAAQ,GAAG,CAAC,WAAW,IAAI,aAAa;YAC9O;QACF;QACA,SAAS;YACP,SAAS;YACT,MAAM;YACN,SAAS;QACX;QACA,QAAQ;YACN,UAAU;YACV,WAAW;YACX,SAAS;QACX;IACF;AACF"}}]
}